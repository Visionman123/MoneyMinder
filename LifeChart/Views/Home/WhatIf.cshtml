@{
	ViewData["Title"] = "What-if Scenario";
}
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Outfit">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="what-if">
	<div class="input-container">
		<p>What-If Scenario</p>
		<label title="Your current age" for="current-age-input" class="whatif-labels">Current Age</label>
		<input type="number" placeholder="Ex: 18" id="current-age-input" required/>

		<label title="Desired age at which you are financially free" for="ffp-age-input" class="whatif-labels">FFP Age</label>
		<input type="number" placeholder="Ex: 65" id="ffp-age-input" required/>

		<label title="Amount you want to spend after FFP" for="spend-input" class="whatif-labels">Spending (USD)</label>
		<input type="text" placeholder="Ex: 30000" id="spend-input" required/>

		<label title="Your country's inflation rate" for="inflation-input" class="whatif-labels">Inflation (%)</label>
		<input type="number" placeholder="Ex: 5" id="inflation-input" required/>

		<label title="Amount of money in your bank" for="bank-input" class="whatif-labels">Bank Assets (USD)</label>
		<input type="text" placeholder="Ex: 10000" id="bank-input" required/>
		<input type="text" id="roi-input" placeholder="ROI (%)" required/>

		<div class="stages-list">
			<ul id="myList">			
				<li><a id="stage1" href="#1"  style="color:black">Stage</a></li>
			</ul>
			<a disabled="disabled" onclick="removeFromList()" id="remove">-</a>
			<a onclick="addToList()" id="add">+</a>
		</div>
		<div class="stages-input" id="1">

			<label title="Your starting age" id="lbl-current-age-input-1" for="current-age-input-1" class="whatif-labels">From</label>
			<input type="number" placeholder="Ex: 18"  id="current-age-input-1" required disabled/>

			<label title="Your ending age" id="lbl-ffp-age-input-1" for="ffp-age-input-1" class="whatif-labels">To</label>
			<input type="number" placeholder="Ex: 65" id="ffp-age-input-1" required/>

			<label title="Annual increase in your saving" id="lbl-increase-input-1" for="increase-input-1" class="whatif-labels">Annual Increase Saving (%)</label>
			<input type="number" placeholder="Ex: 10" id="increase-input-1" required/>

			<label title="Amount to save per month to achieve FFP (optional)" id="lbl-save-monthly-1" for="save-monthly-1" class="whatif-labels">Save per month (USD)</label>
			<input type="number" placeholder="Ex: 10000" id="save-monthly-1" />

		</div>

		<div class="stages-input" id="2">

			<label title="Your starting age" for="current-age-input-2" class="whatif-labels">From 2</label>
			<input type="number" placeholder="Ex: 40" id="current-age-input-2" required disabled/>

			<label title="Your ending age" for="ffp-age-input-2" class="whatif-labels">To 2</label>
			<input type="number" placeholder="Ex: 65" id="ffp-age-input-2" required/>

			<label title="Annual increase in your saving" for="increase-input-2" class="whatif-labels">Annual Increase Saving 2 (%)</label>
			<input type="number" placeholder="Ex: 10" id="increase-input-2" required/>

			<label title="Amount to save per month to achieve FFP (optional)" for="save-monthly-2" class="whatif-labels">Save per month 2 (USD)</label>
			<input type="number" placeholder="Ex: 10000" id="save-monthly-2"/>
			

		</div>

		<div class="stages-input" id="3">

			<label title="Your starting age" for="current-age-input-3" class="whatif-labels">From 3</label>
			<input type="number" placeholder="Ex: 50" id="current-age-input-3" required disabled/>

			<label title="Your ending age" for="ffp-age-input-3" class="whatif-labels">To 3</label>
			<input type="number" placeholder="Ex: 65" id="ffp-age-input-3" required/>

			<label title="Annual increase in your saving" for="increase-input-3" class="whatif-labels">Annual Increase Saving 3 (%)</label>
			<input type="number" placeholder="Ex: 10" id="increase-input-3" required/>

			<label title="Amount to save per month to achieve FFP (optional)" for="save-monthly-3" class="whatif-labels">Save per month 3 (USD)</label>
			<input type="number" placeholder="Ex: 10000" id="save-monthly-3" />


		</div>

		

		<div class="whatif-buttons">
			<button onclick="calculate()" id="calculate">Calculate</button>
			<button onclick="save()" id="save">Save</button>
		</div>

		<br />
		<p id="error-line" style="color: red"></p>

	</div>
	<div class="answer-container">
	<div class="chart-container">
		<canvas id="myChart" style="margin-top:50px;"></canvas>
	</div>
	<div class="answer">
		<span class="ans" id="span-answer"></span>
			<p id="answer"></p>
	</div>
	</div>
</div>
<style>
	
	html {
		height: 100%;
	}

	body {
		background-color: #03030F;
	}
	
	p {
		font-family: "Outfit";
		font-weight: bold;
		margin-left: auto;
		margin-right: auto;
	}

	.what-if {
		display: flex;
		flex-direction: row;
		width: 100%;
		height: 100%;
		column-gap: 5vw;
		padding-top: 5vh;
	}

	.whatif-labels:hover {
		cursor: pointer
	}

	.input-container {
		background-color: white;
		display: flex;
		flex-direction: column;
		align-items: start;
		width: 25vw;
		height: 105vh;
		margin-left: 5vw;
		border-radius: 30px;

		
	}
	.stages-list{
		font-family: "Outfit";
		display: flex;
		width:100%;
		align-items:center;		
	}
	ul {
		padding:0;
	
	}
	li {
		font-weight:bold;
	}

	a[disabled="disabled"] {
		display: none;
	}
	
	input:disabled {
		cursor: not-allowed;
		background-color: lightgray;
	}

	#remove {
		font-family: "Outfit";
		color: black;
		font-size: 22px;
		font-weight: 350;
		margin-left: 10px;
		height: 32px;
	}

	#remove:hover {
		cursor: pointer;
	}

	#add {
		font-family: "Outfit";
		color: black;
		font-size: 22px;
		font-weight: 350;
		margin-left: 5px;
	}
	#add:hover{
		cursor:pointer;
	}

	.stages-input {
		width: 100%;
		display: none;
	
	}

	.stages-input:target {
		display: flex;
		flex-direction: column;
	}
	.chart-container {
		display:flex;
		/* align-items:center; */
		/* justify-content:center; */
		background-color: white;
		width: 60vw;
		height: 75vh;
		border-radius: 30px;

	}
	
	label {
		margin-bottom: 0px;
		font-family: "Outfit";
		font-weight: thin;
		margin-left: 10%;
	}

	.whatif-buttons {
		margin-top: 10px;
		margin-left: auto;
		margin-right: auto;
		display: inline-flex;
		gap: 10px;
	}
	#calculate {
		background-color:black;
		color:white;
		margin-left: auto;
		margin-right: auto;
		border-radius:30px;
		padding:7px 30px 7px 30px;
	}
	#calculate:hover{
		cursor: pointer;
	}

	#save {
		background-color: black;
		color: white;
		margin-left: auto;
		margin-right: auto;
		border-radius: 30px;
		padding: 7px 30px 7px 30px;
	}

	#save:hover {
		cursor: pointer;
	}
	input {
		border: none;
		border-bottom: 1px solid black;
		margin-bottom: 10px;
		font-family: "Outfit";
		/* font-weight: thinner; */
		margin-left: 10%;
		width:70%;
	}

	input[type=number]::-webkit-inner-spin-button, 
	input[type=number]::-webkit-outer-spin-button { 
	  -webkit-appearance: none; 
	  margin: 0; 
	}

	.ans{
		font-family:"Outfit";
	}
	.answer{
		background-color: white;
		border-radius: 30px;
		margin-top:20px;
		height:15vh;
		display:flex;
		flex-direction:column;
		justify-content:center;
		align-items:center;
	}
	footer {
		display: none;
	}
</style>
<script>
	
	//events
	document.getElementById("current-age-input").addEventListener("input", (e) => {
		document.getElementById("current-age-input-1").value = e.target.value
	})
	document.getElementById("ffp-age-input").addEventListener("input", (e) => {
		let i = document.getElementById("myList").getElementsByTagName("li").length;
		document.getElementById("ffp-age-input-" + i).value = e.target.value;
	})
	document.getElementById("ffp-age-input-1").addEventListener("input", (e) => {
		document.getElementById("current-age-input-2").value = parseInt(e.target.value) + 1;
	})
	document.getElementById("ffp-age-input-2").addEventListener("input", (e) => {
		document.getElementById("current-age-input-3").value = parseInt(e.target.value) + 1;
	})

	function validateTopMostInput() {
		if (document.getElementById("current-age-input").value.length === 0
			|| document.getElementById("ffp-age-input").value.length === 0
			|| document.getElementById("spend-input").value.length === 0
			|| document.getElementById("inflation-input").value.length === 0
			|| document.getElementById("bank-input").value.length === 0
			|| document.getElementById("roi-input").value.length === 0
		) {
			document.getElementById("error-line").innerText = `Missing value on top-most required input fields`;
			return false;
		}
		return true;
	}

	function addToList() {
		let i = document.getElementById("myList").getElementsByTagName("li").length;
		if (!validateInputOnAddStage(i)) return;
		document.getElementById("error-line").innerText = "";

		autoCompleteFields(i);

		const myList = document.getElementById("myList");
		const newListItem = document.createElement("li");
		const linkElement = document.createElement("a");
		
		const firstElement = document.getElementById("stage1");
		const firstCurrentAgeInput = document.getElementById("lbl-current-age-input-1");
		const firstFFPAgeInput = document.getElementById("lbl-ffp-age-input-1");
		const firstIncreaseInput = document.getElementById("lbl-increase-input-1");
		const firstSaveInput = document.getElementById("lbl-save-monthly-1");
		firstElement.innerText = "Stage 1"; 
		firstCurrentAgeInput.innerText = "From 1";
		firstFFPAgeInput.innerText = "To 1";
		firstIncreaseInput.innerText = "Annual Increase Saving 1 (%)";
		firstSaveInput.innerText = "Save per month 1 (USD)";

		linkElement.innerText = "Stage " + (i + 1);
		linkElement.href = "#" + (i + 1);
		linkElement.style.color = "black";

		newListItem.appendChild(linkElement);
		newListItem.setAttribute("id", "stage" + (i+1));
		myList.appendChild(newListItem);

		const removeBtn = document.getElementById("remove");
		removeBtn.removeAttribute("disabled");
		const addBtn = document.getElementById("add");
		//force display on stage
		addBtn.setAttribute("href", "#" + (i+1));

		if (i+1 === 3) {
			addBtn.setAttribute("disabled", "disabled");
		}
	}

	function validateInputOnAddStage(i) {
		if (!validateTopMostInput()) return false;
		if (parseInt(document.getElementById("ffp-age-input-" + i).value) >= parseInt(document.getElementById("ffp-age-input").value)) {
			document.getElementById("error-line").innerText = `To ${i} must be lower than FFP age`;
			return false;
		}

		for (let j = 1; j <= i; j++) {
			if (document.getElementById("current-age-input-" + j).value.length === 0 || document.getElementById("ffp-age-input-" + j).value.length === 0 || document.getElementById("increase-input-" + j).value.length === 0) {
				document.getElementById("error-line").innerText = `Missing value on required input fields (Stage ${j})`;
				return false;
			}
			if (parseInt(document.getElementById("current-age-input-" + j).value) >= parseInt(document.getElementById("ffp-age-input-" + j).value)) {
				document.getElementById("error-line").innerText = `To ${j} must be higher than From ${j}`;
				return false;
			}
			if (parseInt(document.getElementById("ffp-age-input-" + j).value) > parseInt(document.getElementById("ffp-age-input").value)) {
				document.getElementById("error-line").innerText = `To ${j} must be lower or equal to FFP Age`;
				return false;
			}
		}
		return true;
	}

	function autoCompleteFields(i) {
		document.getElementById("current-age-input-" + (i+1)).value = parseInt(document.getElementById("ffp-age-input-" + i).value) + 1;
		document.getElementById("ffp-age-input-" + (i + 1)).value = parseInt(document.getElementById("ffp-age-input").value);
	}

	function removeFromList() {
		let i = document.getElementById("myList").getElementsByTagName("li").length;
		const item = document.getElementById("stage" + i);
		item.parentNode.removeChild(item);

		//invalidate all inputs from removed stage
		document.getElementById("current-age-input-" + i).value = "";
		document.getElementById("ffp-age-input-" + i).value = "";
		document.getElementById("increase-input-" + i).value = "";
		document.getElementById("save-monthly-" + i).value = "";

		//default ffp age of latest stage to ffp age
		document.getElementById("ffp-age-input-" + (i - 1)).value = parseInt(document.getElementById("ffp-age-input").value);
		const removeBtn = document.getElementById("remove");
		const addBtn = document.getElementById("add");
		if (addBtn.hasAttribute("disabled")) { 
			addBtn.removeAttribute("disabled");
		}

		//force display on stage
		removeBtn.setAttribute("href", "#" + (i-1));
		addBtn.setAttribute("href", "#" + (i-1));		
		
		if (i-1 === 1) {
			const firstElement = document.getElementById("stage1");
			const firstCurrentAgeInput = document.getElementById("lbl-current-age-input-1");
			const firstFFPAgeInput = document.getElementById("lbl-ffp-age-input-1");
			const firstIncreaseInput = document.getElementById("lbl-increase-input-1");
			const firstSaveInput = document.getElementById("lbl-save-monthly-1");
			firstElement.innerText = "Stage";
			firstCurrentAgeInput.innerText = "From";
			firstFFPAgeInput.innerText = "To";
			firstIncreaseInput.innerText = "Annual Increase Saving (%)";
			firstSaveInput.innerText = "Save per month (USD)";
			
			removeBtn.setAttribute("disabled", "disabled");
		} 
	}

	function validateOnCalculate() {
		if (!validateTopMostInput()) return false;

		let i = document.getElementById("myList").getElementsByTagName("li").length;
		for (let j = 1; j <= i; j++) {
			if (document.getElementById("current-age-input-" + j).value.length === 0
				|| document.getElementById("ffp-age-input-" + j).value.length === 0
				|| document.getElementById("increase-input-" + j).value.length === 0
			) {
				document.getElementById("error-line").innerText = `Missing value on required input fields (Stage ${j})`;
				return false;
			}
			if (parseInt(document.getElementById("current-age-input-" + j).value) >= parseInt(document.getElementById("ffp-age-input-" + j).value)) {
				document.getElementById("error-line").innerText = `To ${j} must be higher than From ${j}`;
				return false;
			}
			if (parseInt(document.getElementById("ffp-age-input-" + j).value) > parseInt(document.getElementById("ffp-age-input").value)) {
				document.getElementById("error-line").innerText = `To ${j} must be lower or equal to FFP Age`;
				return false;
			}
		}
		return true;
	}

	function calculate() {
		if (!validateOnCalculate()) return;
		document.getElementById("error-line").innerText = "";

		// What-if input
		const ageLife = parseInt(document.getElementById("current-age-input").value);
		const ffpLife = parseInt(document.getElementById("ffp-age-input").value);
		const moneyFFP = parseInt(document.getElementById("spend-input").value); // Monthly money required after financial freedom point
		const inflation = parseFloat(document.getElementById("inflation-input").value) / 100; // Inflation of the country
		const bankAsset = parseInt(document.getElementById("bank-input").value); // Total money in the bank NOW
		const bankROI = parseFloat(document.getElementById("roi-input").value) / 100; // Bank return_of_investment (e.g., 6%)

		const currentAge = parseInt(document.getElementById("current-age-input-1").value);
		const ffpAge = parseInt(document.getElementById("ffp-age-input-1").value); // Financial freedom point age
		const annualIncrease = parseFloat(document.getElementById("increase-input-1").value) / 100;
		const saveMonthly = parseInt(document.getElementById("save-monthly-1").value);

		const currentAge2 = parseInt(document.getElementById("current-age-input-2").value);
		const ffpAge2 = parseInt(document.getElementById("ffp-age-input-2").value); // Financial freedom point age
		const annualIncrease2 = parseFloat(document.getElementById("increase-input-2").value) / 100;
		const saveMonthly2 = parseInt(document.getElementById("save-monthly-2").value);

		const currentAge3 = parseInt(document.getElementById("current-age-input-3").value);
		const ffpAge3 = parseInt(document.getElementById("ffp-age-input-3").value); // Financial freedom point age
		const annualIncrease3 = parseFloat(document.getElementById("increase-input-3").value) / 100;
		const saveMonthly3 = parseInt(document.getElementById("save-monthly-3").value);

		//xvalue for chart
		var life = [];
		var last = ffpLife - ageLife;
		for (var i = 0; i <= last; i++) {
			life[i] = currentAge + i;
		}		

		// Event
		const eventAge = 30;
		const eventIncome = 0;

		// Pension expected
		const pension = 0;

		function generateStages(stageInfo) {
			const stages = [];

			for (let i = 0; i < stageInfo.length; i++) {
				const { start, end, toSavePerMonth, annualIncrease } = stageInfo[i];

				const stage = {
					stageNumber: i + 1,
					moneyEarnAnnual: [],
					moneyEarnAnnualWithBankROI: [],
					totalSave: null,
					toSavePerMonth,
					start,
					end,
					annualIncrease,
				};

				stages.push(stage);
			}

			return stages;
		}

		// Generate stages
		const stageInfo = [
			{ start: currentAge, end: ffpAge, toSavePerMonth: saveMonthly, annualIncrease: annualIncrease },
			{ start: currentAge2, end: ffpAge2, toSavePerMonth: saveMonthly2, annualIncrease: annualIncrease2 },
			{ start: currentAge3, end: ffpAge3, toSavePerMonth: saveMonthly3, annualIncrease: annualIncrease3 },

		];
		
		const stages = generateStages(stageInfo);

		// Calculation Total Money needed
		const moneyNeed = (moneyFFP - pension) * 12 * 25 * Math.pow(1 + inflation, ffpLife - ageLife); // Money required after FFP
		const moneyEvent = eventIncome * Math.pow(1 + bankROI, ffpLife - eventAge);
		const BankAsset = bankAsset * Math.pow(1 + bankROI, ffpLife - eventAge);
		const totalMoneyNeed = moneyNeed - moneyEvent - BankAsset;
	
		// Function to calculate sigma of a given function
		function sigma(start, end, func) {
			let sum = 0;
			for (let i = start; i < end; i++) {
				sum += func(i);
			}
			return sum;
		}

		// Function to find the reverse of sigma using Newton-Raphson method
		function findReverseSigma(targetSum, func, initialGuess, tolerance) {
			let x = initialGuess;
			let previousX;

			do {
				previousX = x;
				x = x - (func(x) - targetSum) / calculateDerivative(func, x);
			} while (Math.abs(x - previousX) > tolerance);

			return x;
		}

		// Function to calculate the derivative of a given function using a small step value
		function calculateDerivative(func, x) {
			const step = 0.0001; // Small step value
			return (func(x + step) - func(x)) / step;
		}

		// Calculate money that the user can save each year
		function calculateAnnualSaving(stageNumber, start, end, monthlySaving, annualIncrease) {
			if (stageNumber != 1) {
				monthlySaving = monthlySaving * Math.pow((1 + inflation), (start - currentAge));
			}

			const annualSaving = [];
			for (let i = 0; i <= end - start; i++) {
				const amount = (monthlySaving * 12) * Math.pow(1 + annualIncrease, i);
				const age = start + i;
				annualSaving.push({ age, amount });
			}

			return annualSaving;
		}
		
		// Calculate money that the user can save each year then put it into the bank
		function calculateAnnualSavingWithBankROI(start, end, annualSaving, bankROI) {
			const annualSavingWithBankROI = [];

			console.log(start, end);
			for (let i = 0; i <= end - start; i++) {
				const age = annualSaving[i].age;
				const amount = annualSaving[i].amount * Math.pow(1 + bankROI, ffpLife - age);
				annualSavingWithBankROI.push({ age, amount });
			}

			return annualSavingWithBankROI;
		}

		// Calculate Total_moneyEarnAnnualWithBankROI using the provided functions
		function calculateTotalAnnualSavingWithBankROI(stages, monthlySavingRequired, bankROI) {
			const totalAnnualSaving = [];
			stages.forEach((stage) => {

				stage.moneyEarnAnnual = calculateAnnualSaving(stage.stageNumber, stage.start, stage.end, stage.toSavePerMonth ? stage.toSavePerMonth : monthlySavingRequired, stage.annualIncrease);

				stage.moneyEarnAnnualWithBankROI = calculateAnnualSavingWithBankROI(stage.start, stage.end, stage.moneyEarnAnnual, bankROI);

				stage.moneyEarnAnnualWithBankROI.forEach((x) => {
					totalAnnualSaving.push(x);
				});
			});
			return sigma(0, totalAnnualSaving.length, (i) => totalAnnualSaving[i].amount);
		}

		// Example usage: Find the money_save needed to achieve the target Total_money_need
		const initialGuess = 1000; // Replace with an initial guess close to the solution
		const tolerance = 0.01; // Tolerance for stopping the iteration

		const moneyToSavePerMonth = findReverseSigma(totalMoneyNeed, (x) => calculateTotalAnnualSavingWithBankROI(stages, x, bankROI), initialGuess, tolerance);

		
		// Generate new stages info
		function StageInfoUpdate(stages, moneyToSavePerMonth) {
			const filledStages = stages.map((stage, index) => {
				stage.toSavePerMonth = stage.toSavePerMonth || moneyToSavePerMonth;

				return stage;
			});
			return filledStages;
		}
		const NewStages = StageInfoUpdate(stages, moneyToSavePerMonth);

		// An Array annualSaving per year from the begin to the end:
		function generateCombinedMonthlySavings(stages) {
			const combinedSavings = [];

			stages.forEach((stage) => {
				const { toSavePerMonth, start, end, annualIncrease } = stage;

				let monthlySaving = toSavePerMonth * 12;
				if (stage.stageNumber !== 1) {
					// Adjust monthly saving based on inflation for subsequent stages
					monthlySaving *= Math.pow(1 + inflation, start - currentAge);
				}

				for (let age = start; age <= end; age++) {
					combinedSavings.push({ age, monthlySaving });
					// Increase monthly saving based on the annual increase for each age
					monthlySaving *= (1 + annualIncrease);
				}
			});

			return combinedSavings;
		}

		// Usage with the provided stages (Yellow Line = ArrayAnnualSaving)
		const ArrayAnnualSaving = generateCombinedMonthlySavings(stages);
		

		var moneyAnnual = [];
		for (var i = 0; i < ArrayAnnualSaving.length; i++) {
			moneyAnnual.push(ArrayAnnualSaving[i].monthlySaving);
		}

		// An Array of Bank account amount from the begin to the end:
		function calculateTotalSavingsAtEachAge(ArrayAnnualSaving) {
			const totalSavingsAtEachAge = [];

			let accumulator = 0;

			for (const savings of ArrayAnnualSaving) {
				if (accumulator == 0) {
					accumulator = (accumulator + savings.monthlySaving);
				} else {
					accumulator = accumulator * (1 + bankROI) + savings.monthlySaving;
				}
				totalSavingsAtEachAge.push({ age: savings.age, total: accumulator });
			}

			return totalSavingsAtEachAge;
		}


		// Usage with the previously generated ArrayAnnualSaving array (Red line = totalSavingsAtEachAge)
		const totalSavingsAtEachAge = calculateTotalSavingsAtEachAge(ArrayAnnualSaving);
		
		var moneyCreated = [];
		for (var i = 0; i < totalSavingsAtEachAge.length; i++) {
			moneyCreated.push(totalSavingsAtEachAge[i].total)
		}
		// Total Money (Green Line = totalMoneyNeed)
		
		var goal = [];
		for (var i = ageLife; i <= ffpLife; i++) {
			goal.push(totalMoneyNeed);
		}


		let saveEnough = false;
		if (moneyToSavePerMonth.toString().includes("Infinity") && moneyToSavePerMonth.toString().slice(0,1) === "-") {
			document.getElementById("span-answer").innerHTML= "";
			document.getElementById("answer").innerHTML= "You will achieve FFP at the desired age";
			saveEnough = true;
		}
		else if (moneyToSavePerMonth.toString().includes("Infinity")) {
			document.getElementById("span-answer").innerHTML= "";
			document.getElementById("answer").innerHTML= "You will not achieve FFP at the desired age";
			saveEnough = false;
		}
		else {
			document.getElementById("span-answer").innerHTML= `To achieve FFP, you will need to save this much per month for stage `;
			let i = document.getElementById("myList").getElementsByTagName("li").length;
			for (let j = 1; j <= i; j++) {
				if (document.getElementById("save-monthly-" + j).value.length === 0) {
					document.getElementById("span-answer").innerHTML+= `${j}, `;
				}
			}
			document.getElementById("span-answer").innerHTML= document.getElementById("span-answer").innerHTML.slice(0, -2);
			document.getElementById("answer").innerHTML= moneyToSavePerMonth;
			saveEnough = true;
		}

		//destroy current chart
		var currentChart = Chart.getChart("myChart");
		if (currentChart !== undefined) {
			currentChart.destroy();
		}
	
		const xValues = life;
		var newChart = new Chart("myChart", {
			type: "line",
			data: {
				labels: xValues,
				datasets: [{
					label: 'Money to save annual',
					data: moneyAnnual,
					borderColor: "yellow",
					fill: false
				}, {
					label: 'Goal',
					data: goal,
					borderColor: "green",
					fill: false
				}
					, {
					label: 'Money generated',
					data: moneyCreated,
					borderColor: "red",
					fill: false
				}]
			},
			options: {
				legend: {},
					title: {
					display: true,
					text: "Life Chart"
				}
			}
		});
	}

	function save() {
		const currentAge = parseInt(document.getElementById("current-age-input-1").value);
		const ffpAge = parseInt(document.getElementById("ffp-age-input-1").value); // Financial freedom point age
		const moneyFFP = parseInt(document.getElementById("spend-input").value); // Monthly money required after financial freedom point
		const inflation = parseFloat(document.getElementById("inflation-input").value) / 100; // Inflation of the country
		const annualIncrease = parseFloat(document.getElementById("increase-input").value) / 100;
		const saveMonthly = parseFloat(document.getElementById("save-monthly").value);

		const currentAge2 = parseInt(document.getElementById("current-age-input-2").value);
		const ffpAge2 = parseInt(document.getElementById("ffp-age-input-2").value); // Financial freedom point age
		const annualIncrease2 = parseFloat(document.getElementById("increase-input-2").value) / 100;
		const saveMonthly2 = parseInt(document.getElementById("save-monthly-2").value);

		const currentAge3 = parseInt(document.getElementById("current-age-input-3").value);
		const ffpAge3 = parseInt(document.getElementById("ffp-age-input-3").value); // Financial freedom point age
		const annualIncrease3 = parseFloat(document.getElementById("increase-input-3").value) / 100;
		const saveMonthly3 = parseInt(document.getElementById("save-monthly-3").value);

		//xvalue for chart
		const ageLife = parseInt(document.getElementById("current-age-input").value);
		const ffpLife = parseInt(document.getElementById("ffp-age-input").value);

		// Capital Asset
		const bankAsset = parseInt(document.getElementById("bank-input").value); // Total money in the bank NOW
		const bankROI = parseFloat(document.getElementById("roi-input").value) / 100;

		const answer = document.getElementById("answer").value //parseInt(document.getElementById("answer").value);

		$.ajax({
			url: '@Url.Action("SaveWhatIf", "Home")',
			type: 'POST',
			dataType: 'json',
			data: { currentAge: ageLife, ffpAge: ffpLife, monthlySpending: moneyFFP, inflation: inflation, bankAsset: bankAsset, bankROI: bankROI,
				startStage1: currentAge, endStage1: ffpAge, annualIncreaseStage1: annualIncrease, saveMonthlyStage1: saveMonthly, 
				startStage2: currentAge2, endStage2: ffpAge2, annualIncreaseStage2: annualIncrease2, saveMonthlyStage2: saveMonthly2,
				startStage3: currentAge3, endStage3: ffpAge3, annualIncreaseStage3: annualIncrease3, saveMonthlyStage3: saveMonthly3,
			},
			success: async function (data) {
				// Handle the API response
				console.log("API Response:", data);
			},
			error: function (error) {
				console.error("API Request Failed:", error);
			}
		});
	}

</script>